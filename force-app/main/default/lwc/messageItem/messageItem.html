<template>
    <div class={messageClass}>
        <div class="message-content">
            <div class="message-header">
                <div class="message-avatar-container">
                    <template if:true={isUserMessage}>
                        <div class="avatar-circle user-avatar">
                            <lightning-icon 
                                icon-name="utility:user" 
                                size="x-small"
                                class="avatar-icon">
                            </lightning-icon>
                        </div>
                    </template>
                    <template if:true={isAssistantMessage}>
                        <div class="avatar-circle assistant-avatar">
                            <lightning-icon 
                                icon-name="utility:robot" 
                                size="x-small"
                                class="avatar-icon">
                            </lightning-icon>
                        </div>
                    </template>
                    <div class="message-info">
                        <span class="message-type">
                            {messageTypeLabel}
                        </span>
                        <span class="message-time">
                            {formattedTime}
                        </span>
                    </div>
                </div>
                <div class="context7-badges" if:true={hasContext7Data}>
                    <span class="context7-badge">
                        <lightning-icon 
                            icon-name="utility:knowledge_base" 
                            size="x-small" 
                            class="context7-icon">
                        </lightning-icon>
                        Context7
                    </span>
                </div>
            </div>
            
            <div class="message-text">
                <template if:true={isCodeBlock}>
                    <lightning-formatted-rich-text 
                        value={formattedContent}>
                    </lightning-formatted-rich-text>
                </template>
                <template if:false={isCodeBlock}>
                    <lightning-formatted-text 
                        value={message.content}>
                    </lightning-formatted-text>
                </template>
            </div>
            
            <!-- Suggestions -->
            <template if:true={message.suggestions}>
                <div class="suggestions">
                    <template for:each={message.suggestions} for:item="suggestion">
                        <span 
                            key={suggestion}
                            class="suggestion-chip"
                            onclick={handleSuggestionClick}
                            data-suggestion={suggestion}>
                            {suggestion}
                        </span>
                    </template>
                </div>
            </template>
            
            <!-- Context7 Library Info -->
            <template if:true={hasContext7Data}>
                <div class="context7-info">
                    <template for:each={message.metadata.context7Libraries} for:item="library">
                        <div key={library.libraryId} class="library-info">
                            <lightning-icon 
                                icon-name="utility:knowledge_base" 
                                size="x-small">
                            </lightning-icon>
                            <span class="library-name">{library.name}</span>
                            <span class="library-version">v{library.version}</span>
                        </div>
                    </template>
                </div>
            </template>
        </div>
        
        <!-- Message Actions -->
        <div class="message-actions">
            <template if:true={showActions}>
                <button 
                    class="message-action-btn"
                    onclick={handleCopy}
                    title="Copy to clipboard">
                    <lightning-icon 
                        icon-name="utility:copy" 
                        size="x-small">
                    </lightning-icon>
                </button>
                
                <template if:true={isUserMessage}>
                    <button 
                        class="message-action-btn"
                        onclick={handleEdit}
                        title="Edit message">
                        <lightning-icon 
                            icon-name="utility:edit" 
                            size="x-small">
                        </lightning-icon>
                    </button>
                </template>
                
                <template if:true={isAssistantMessage}>
                    <button 
                        class="message-action-btn"
                        onclick={handleRegenerate}
                        title="Regenerate response">
                        <lightning-icon 
                            icon-name="utility:refresh" 
                            size="x-small">
                        </lightning-icon>
                    </button>
                </template>
            </template>
        </div>
    </div>
</template>
